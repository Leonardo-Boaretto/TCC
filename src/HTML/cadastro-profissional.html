<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Profissionais - CVS</title>
    <link rel="stylesheet" href="../CSS/style.css">
    <link rel="stylesheet" href="../CSS/cadastro-profissional.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .required-field::after {
            content: " *";
            color: red;
        }
    </style>
</head>
<body>
    <header class="bg-white text-center py-3">
        <div class="container">
            <h1 class="text-primary mb-0">CVS</h1>
            <p class="text-primary mb-0">Administração CVS</p>
        </div>
    </header>

    <div class="container mt-5">
        <h2 class="text-center mb-4">Cadastro de Profissionais</h2>
        
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="medico-tab" data-bs-toggle="tab" data-bs-target="#medico" type="button" role="tab">Médico</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="funcionario-tab" data-bs-toggle="tab" data-bs-target="#funcionario" type="button" role="tab">Funcionário</button>
                            </li>
                        </ul>

                        <div class="tab-content mt-4" id="myTabContent">
                            <!-- Formulário Médico -->
                            <div class="tab-pane fade show active" id="medico" role="tabpanel">
                                <form id="formMedico">
                                    <div class="mb-3">
                                        <label for="nomeMedico" class="form-label required-field">Nome Completo</label>
                                        <input type="text" class="form-control" id="nomeMedico" required 
                                               oninput="this.value = this.value.trimStart().replace(/\s{2,}/g, ' ');"
                                               onblur="validarCampoTexto(this, 'nomeMedicoError');">
                                        <div id="nomeMedicoError" class="invalid-feedback" style="display: none;">O nome não pode conter apenas espaços em branco</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="crm" class="form-label required-field">CRM</label>
                                        <input type="number" class="form-control" id="crm" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cpfMedico" class="form-label required-field">CPF</label>
                                        <input type="text" class="form-control" id="cpfMedico" required 
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="especialidade" class="form-label required-field">Especialidade</label>
                                        <select class="form-control" id="especialidade" required>
                                            <option value="">Selecione uma especialidade</option>
                                            <option value="Clinica Geral">Clínica Geral</option>
                                            <option value="Cardiologia">Cardiologia</option>
                                            <option value="Dermatologia">Dermatologia</option>
                                            <option value="Endocrinologia">Endocrinologia</option>
                                            <option value="Ginecologia">Ginecologia</option>
                                            <option value="Ortopedia">Ortopedia</option>
                                            <option value="Pediatria">Pediatria</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="emailMedico" class="form-label required-field">Email</label>
                                        <input type="email" class="form-control" id="emailMedico" required
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="telefoneMedico" class="form-label required-field">Telefone</label>
                                        <input type="tel" class="form-control" id="telefoneMedico" required
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="cepMedico" class="form-label required-field">CEP</label>
                                        <input type="text" class="form-control" id="cepMedico" required
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="enderecoMedico" class="form-label required-field">Endereço</label>
                                        <input type="text" class="form-control" id="enderecoMedico" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="numeroMedico" class="form-label required-field">Número</label>
                                        <input type="text" class="form-control" id="numeroMedico" required
                                               oninput="this.value = this.value.replace(/[^0-9]/g, '').trimStart(); if(this.value < 0) this.value = ''; if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="bairroMedico" class="form-label required-field">Bairro</label>
                                        <input type="text" class="form-control" id="bairroMedico" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cidadeMedico" class="form-label required-field">Cidade</label>
                                        <input type="text" class="form-control" id="cidadeMedico" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="estadoMedico" class="form-label required-field">Estado</label>
                                        <input type="text" class="form-control" id="estadoMedico" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="senhaMedico" class="form-label required-field">Senha:</label>
                                        <input type="password" class="form-control" id="senhaMedico" required maxlength="12">
                                        <div class="senha-requisitos">
                                            <p>A senha deve conter:</p>
                                            <ul>
                                                <li>Mínimo 6 e máximo 12 caracteres</li>
                                                <li>Pelo menos uma letra maiúscula</li>
                                                <li>Pelo menos um número</li>
                                                <li>Pelo menos um caractere especial (!@#$%^&*)</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="confirmarSenhaMedico" class="form-label required-field">Confirmar Senha:</label>
                                        <input type="password" class="form-control" id="confirmarSenhaMedico" required maxlength="12">
                                    </div>
                                    <button type="submit" class="btn btn-primary">Cadastrar Médico</button>
                                </form>
                            </div>

                            <!-- Formulário Funcionário -->
                            <div class="tab-pane fade" id="funcionario" role="tabpanel">
                                <form id="formFuncionario">
                                    <div class="mb-3">
                                        <label for="nomeFuncionario" class="form-label required-field">Nome Completo</label>
                                        <input type="text" class="form-control" id="nomeFuncionario" required
                                               oninput="this.value = this.value.trimStart().replace(/\s{2,}/g, ' ');"
                                               onblur="validarCampoTexto(this, 'nomeFuncionarioError');">
                                        <div id="nomeFuncionarioError" class="invalid-feedback" style="display: none;">O nome não pode conter apenas espaços em branco</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cpfFuncionario" class="form-label required-field">CPF</label>
                                        <input type="text" class="form-control" id="cpfFuncionario" required
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="dataNascimentoFuncionario" class="form-label required-field">Data de Nascimento</label>
                                        <input type="date" class="form-control" id="dataNascimentoFuncionario" required
                                               title="Idade mínima 18 anos"
                                               onchange="validarIdadeMinima(this, 18)">
                                        <div id="dataNascimentoFuncionarioError" class="invalid-feedback" style="display: none;">É necessário ter pelo menos 18 anos para se cadastrar</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="emailFuncionario" class="form-label required-field">Email</label>
                                        <input type="email" class="form-control" id="emailFuncionario" required
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="telefoneFuncionario" class="form-label required-field">Telefone</label>
                                        <input type="tel" class="form-control" id="telefoneFuncionario" required
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="cargoFuncionario" class="form-label required-field">Cargo</label>
                                        <select class="form-control" id="cargoFuncionario" required>
                                            <option value="">Selecione um cargo</option>
                                            <option value="Recepcionista">Recepcionista</option>
                                            <option value="Enfermeiro">Enfermeiro</option>
                                            <option value="Administrador">Administrador</option>
                                            <option value="Técnico de Enfermagem">Técnico de Enfermagem</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="salarioFuncionario" class="form-label required-field">Salário</label>
                                        <input type="number" step="0.01" class="form-control" id="salarioFuncionario" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="dataContratacaoFuncionario" class="form-label required-field">Data de Contratação</label>
                                        <input type="date" class="form-control" id="dataContratacaoFuncionario" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cepFuncionario" class="form-label required-field">CEP</label>
                                        <input type="text" class="form-control" id="cepFuncionario" required
                                               oninput="this.value = this.value.trimStart(); if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="enderecoFuncionario" class="form-label required-field">Endereço</label>
                                        <input type="text" class="form-control" id="enderecoFuncionario" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="numeroFuncionario" class="form-label required-field">Número</label>
                                        <input type="text" class="form-control" id="numeroFuncionario" required
                                               oninput="this.value = this.value.replace(/[^0-9]/g, '').trimStart(); if(this.value < 0) this.value = ''; if(/\s/.test(this.value)) { this.value = this.value.replace(/\s/g, ''); }">
                                    </div>
                                    <div class="mb-3">
                                        <label for="bairroFuncionario" class="form-label required-field">Bairro</label>
                                        <input type="text" class="form-control" id="bairroFuncionario" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cidadeFuncionario" class="form-label required-field">Cidade</label>
                                        <input type="text" class="form-control" id="cidadeFuncionario" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="estadoFuncionario" class="form-label required-field">Estado</label>
                                        <input type="text" class="form-control" id="estadoFuncionario" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="senhaFuncionario" class="form-label required-field">Senha:</label>
                                        <input type="password" class="form-control" id="senhaFuncionario" required maxlength="12">
                                        <div class="senha-requisitos">
                                            <p>A senha deve conter:</p>
                                            <ul>
                                                <li>Mínimo 6 e máximo 12 caracteres</li>
                                                <li>Pelo menos uma letra maiúscula</li>
                                                <li>Pelo menos um número</li>
                                                <li>Pelo menos um caractere especial (!@#$%^&*)</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="confirmarSenhaFuncionario" class="form-label required-field">Confirmar Senha:</label>
                                        <input type="password" class="form-control" id="confirmarSenhaFuncionario" required maxlength="12">
                                    </div>
                                    <button type="submit" class="btn btn-primary">Cadastrar Funcionário</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../JS/cadastro-profissional.js"></script>
    <script>
        // Função para validar idade mínima
        function validarIdadeMinima(input, idadeMinima) {
            if (!input.value) {
                input.setCustomValidity('Informe a data de nascimento');
                return false;
            }
            
            const hoje = new Date();
            const dataNascimento = new Date(input.value);
            const dataMinima = new Date(
                hoje.getFullYear() - idadeMinima,
                hoje.getMonth(),
                hoje.getDate()
            );
            
            if (dataNascimento > dataMinima) {
                input.setCustomValidity('É necessário ter pelo menos 18 anos');
                input.reportValidity();
                input.classList.add('is-invalid');
                document.getElementById(input.id + 'Error').style.display = 'block';
                input.value = '';
                return false;
            } else {
                input.setCustomValidity('');
                input.classList.remove('is-invalid');
                document.getElementById(input.id + 'Error').style.display = 'none';
                return true;
            }
        }
        
        // Função para validar campos de texto (nome)
        function validarCampoTexto(input, errorId) {
            const errorElement = document.getElementById(errorId);
            if (!input.value.trim()) {
                input.classList.add('is-invalid');
                errorElement.style.display = 'block';
                return false;
            } else {
                input.classList.remove('is-invalid');
                errorElement.style.display = 'none';
                return true;
            }
        }

        // Validar formulário de médico antes de enviar
        document.getElementById('formMedico').addEventListener('submit', function(e) {
            const nomeInput = document.getElementById('nomeMedico');
            if (!validarCampoTexto(nomeInput, 'nomeMedicoError')) {
                e.preventDefault();
                return false;
            }
            return true;
        });

        // Validar formulário de funcionário antes de enviar
        document.getElementById('formFuncionario').addEventListener('submit', function(e) {
            const nomeInput = document.getElementById('nomeFuncionario');
            if (!validarCampoTexto(nomeInput, 'nomeFuncionarioError')) {
                e.preventDefault();
                return false;
            }
            return true;
        });

        // Adicionar validação de espaços em branco para campos de texto
        const camposSemEspaco = ['cpfMedico', 'emailMedico', 'telefoneMedico', 'cepMedico', 'numeroMedico',
                               'cpfFuncionario', 'emailFuncionario', 'telefoneFuncionario', 'cepFuncionario', 'numeroFuncionario'];
        
        camposSemEspaco.forEach(campo => {
            const elemento = document.getElementById(campo);
            if (elemento) {
                elemento.addEventListener('blur', function() {
                    if (this.value.trim() === '' && this.hasAttribute('required')) {
                        this.classList.add('is-invalid');
                    } else {
                        this.classList.remove('is-invalid');
                    }
                });
            }
        });

        document.getElementById('formMedico').addEventListener('submit', async (e) => {
            e.preventDefault();

            const nome = document.getElementById('nomeMedico').value;
            const crm = document.getElementById('crm').value;
            const cpf = document.getElementById('cpfMedico').value;
            const especialidade = document.getElementById('especialidade').value;
            const email = document.getElementById('emailMedico').value;
            const telefone = document.getElementById('telefoneMedico').value;
            const cep = document.getElementById('cepMedico').value;
            const endereco = document.getElementById('enderecoMedico').value;
            const numero = document.getElementById('numeroMedico').value;
            const bairro = document.getElementById('bairroMedico').value;
            const cidade = document.getElementById('cidadeMedico').value;
            const estado = document.getElementById('estadoMedico').value;
            const senha = document.getElementById('senhaMedico').value;
            const confirmarSenha = document.getElementById('confirmarSenhaMedico').value;

            if (senha !== confirmarSenha) {
                alert('As senhas não coincidem.');
                return;
            }

            try {
                const response = await fetch('/api/medicos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome,
                        crm,
                        cpf,
                        especialidade,
                        email,
                        telefone,
                        cep,
                        endereco,
                        numero,
                        bairro,
                        cidade,
                        estado,
                        senha
                    })
                });

                if (response.ok) {
                    alert('Médico cadastrado com sucesso!');
                    document.getElementById('formMedico').reset();
                } else {
                    const erro = await response.json();
                    alert(`Erro ao cadastrar médico: ${erro.erro}`);
                }
            } catch (error) {
                console.error('Erro ao cadastrar médico:', error);
                alert('Erro ao cadastrar médico.');
            }
        });
    </script>
</body>
</html>
